<section class="project-topbar" role="region" aria-label="Intestazione progetto">
  <header class="topbar-head">
    <h1 class="topbar-title">{{ project.title }}</h1>
    <div class="collab-assignees-header">
      <div class="assignees-header">
        <form
          class="filter-by-assignees-inline"
          (ngSubmit)="filterByAssignees()"
          autocomplete="off"
          novalidate
        >
          <input
            type="text"
            class="filter-by-assignees-input"
            name="assigneesEmailName"
            [ngModel]="assigneesEmailName" 
            (ngModelChange)="onFilterChange($event)"
            placeholder="Cerca per email o nome incaricato..."
            (focus)="startInlineAddAssignees()"
          />

          @if (addingAssignees()) {
            <button
              type="button"
              class="btn ghost tiny"
              (click)="cancelInlineAddAssignees()"
              (mousedown)="$event.preventDefault()" 
            >
              Annulla
            </button>
          }
        </form>
      </div>
    </div>
  </header>
  
  <div class="topbar-body">
    <div class="topbar-left">
      <div class="topbar-header">
        <button type="button" class="back-to-projects-btn" (click)="goToProjects()" aria-label="Torna ai progetti">
          <lucide-icon name="ChevronLeft" aria-hidden="true"></lucide-icon>
          <span>Progetti</span>
        </button>
      </div>
      @if (project.description) {
        <p class="topbar-sub">{{ project.description }}</p>
      }
    </div>
    <div class="topbar-right">
      <div class="collab-pills" aria-label="Collaboratori">
        <span class="pill creator" title="Creatore">
          <lucide-icon name="User"></lucide-icon>
          <span class="pill-role"></span>
          <span class="pill-name">
            {{ project.creator.firstName }} {{ project.creator.lastName }}
          </span>
        </span>
        @for (c of project.collaborators; track c.id) {
          <span class="pill" title="Collaboratore">
            <lucide-icon name="User"></lucide-icon>
            <span class="pill-role"></span>
            <span class="pill-name">
              {{ c.firstName }} {{ c.lastName }}
            </span>
            <button
              type="button"
              class="pill-x"
              [disabled]="isLoading()"
              (click)="onRemoveCollaborator(c.id)"
              aria-label="Rimuovi collaboratore"
            >
              <lucide-icon name="x"></lucide-icon>
            </button>
          </span>
        }
        <div class="collab-header">
          @if (!addingCollaborator()) {
            <button
              type="button"
              class="add-collab-btn"
              (click)="startInlineAdd()"
              aria-label="Aggiungi collaboratore"
            >
              <lucide-icon name="plus"></lucide-icon>
              <span>Aggiungi</span>
            </button>
          } @else {
            <form
              class="add-collab-inline"
              (ngSubmit)="submitInlineAdd()"
              autocomplete="off"
              novalidate
            >
              <input
                type="email"
                class="add-collab-input"
                name="collabEmail"
                required
                [(ngModel)]="collabEmail"
                placeholder="Email collaboratore..."
              />

              <button
                type="button"
                class="btn ghost tiny"
                (click)="cancelInlineAdd()"
              >
                Annulla
              </button>

              <button type="submit" class="btn tiny" [disabled]="isLoading()">Invita</button>
            </form>
          }
        </div>
      </div>
    </div>
  </div>
</section>