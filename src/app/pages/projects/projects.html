<header class="navbar" role="banner">
<app-navbar (logout)="logout()"></app-navbar>
</header>
<div class="dashboard-container" [class.sidebar-collapsed]="sidebarCollapsed()">
  <app-dashboard-sidebar 
    [collapsed]="sidebarCollapsed()"
    (createProject)="openModal('project')"
    (collapseChanged)="onSidebarCollapse($event)"
  ></app-dashboard-sidebar>
  <main class="projects-main" role="main" aria-label="Elenco progetti">
    <div class="projects-header">
      <h1>I tuoi progetti</h1>
    </div>

    <section class="projects-grid" aria-live="polite">
      @if (loading()) {
        <div class="empty-state">Caricamento in corso…</div>
      } @else if (projects().length === 0) {
        <div class="empty-state">Nessun progetto trovato. Crea un nuovo progetto dalla sidebar.</div>
      } @else {
        @for (p of projects(); track p) {
          <article
            class="project-card"
            (click)="navigateToProject(p)"
            (keydown.enter)="navigateToProject(p)"
            (keydown.space)="navigateToProject(p)"
            tabindex="0"
            role="button"
            aria-label="Apri progetto {{ p.title }}"
          >
            <div class="project-card-header">
              <h2 class="project-title">{{ p.title }}</h2>
              <span class="project-phase-count">Progetto</span>
            </div>

            <p class="project-desc">
              Creato da {{ p.creator.username || '—' }}
            </p>

            <div class="project-meta">
              <span class="meta-item">
                <lucide-icon name="user-circle-2" aria-hidden="true"></lucide-icon>
                {{ (p.collaborators.length || 0) + (p.creator ? 1 : 0) }} membri
              </span>
            </div>
              <div
              class="delete-project"
              (click)="onDeleteProject(p, $event)"
              (keydown.enter)="onDeleteProject(p, $event)"
              tabindex="0"
              role="button"
              aria-label="Elimina progetto {{ p.title }}"
            >
              <lucide-icon name="trash-2" aria-hidden="true"></lucide-icon>
            </div>
          </article>
        }
      }
    </section>
  </main>
</div>
<app-project-modal
  [open]="projectModalOpen()"
  (close)="closeModal()"
  (create)="onCreateProject($event)"
></app-project-modal>
